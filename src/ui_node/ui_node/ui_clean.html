<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoCooker Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .status {
            background: #f0f0f0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            text-align: center;
        }

        .status-text {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #95a5a6;
            margin-left: 10px;
            animation: pulse 2s infinite;
        }

        .status-indicator.running {
            background: #2ecc71;
        }

        .status-indicator.error {
            background: #e74c3c;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .button-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }

        button {
            flex: 1;
            padding: 12px 25px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .start-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .start-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .start-btn:active {
            transform: translateY(0);
        }

        .start-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .stop-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }

        .stop-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.4);
        }

        .stop-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .emergency-btn {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }

        .emergency-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(241, 196, 15, 0.4);
        }

        .emergency-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }

        .yolo-container {
            background: #2c3e50;
            border-radius: 10px;
            padding: 20px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 1.2em;
            text-align: center;
            color: #ecf0f1;
        }

        .current-object {
            font-size: 1.3em;
            font-weight: bold;
            color: #3498db;
        }

        .spinner {
            display: none;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .spinner.active {
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ CoCooker</h1>
        <p class="subtitle">ROS2 Control Panel</p>

        <div class="status">
            <div class="status-text">
                ÏÉÅÌÉú: <span id="status">ÎåÄÍ∏∞ Ï§ë</span>
                <span class="status-indicator" id="indicator"></span>
            </div>
            <div class="spinner" id="spinner"></div>
        </div>

        <div class="button-container">
            <button class="start-btn" id="startBtn" onclick="startPickAndPlace()">
                ‚ñ∂ Start
            </button>
            <button class="stop-btn" id="stopBtn" onclick="stopPickAndPlace()" disabled>
                ‚èπ Stop
            </button>
            <button class="emergency-btn" id="emergencyBtn" onclick="emergencyStop()">
                ‚ö†Ô∏è Emergency
            </button>
        </div>

        <div class="yolo-container">
            <div>ÌòÑÏû¨ ÌÉêÏßÄ Ï§ëÏù∏ Í∞ùÏ≤¥</div>
            <div class="current-object" id="currentObject">-</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // ÎîîÎ≤ÑÍ∑∏ Î°úÍ∑∏ Ìï®Ïàò (ÏΩòÏÜîÏóêÎßå Ï∂úÎ†•)
        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString('ko-KR');
            console.log(`[${timestamp}] ${message}`);
        }

        const firebaseConfig = {
            apiKey: "AIzaSyAHI5d9VNE4J11ZUiwbLqm1MB3i23bmVuI",
            authDomain: "cocooker.firebaseapp.com",
            databaseURL: "https://cocooker-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "cocooker",
            storageBucket: "cocooker.firebasestorage.app",
            messagingSenderId: "415362583003",
            appId: "1:415362583003:web:abef67dbd4cd935ed43ffe",
            measurementId: "G-S6LV9HB46M"
        };

        // Firebase Ï¥àÍ∏∞Ìôî
        debugLog('Firebase Ï¥àÍ∏∞Ìôî ÏãúÏûë...');
        let database;
        try {
            const app = firebase.initializeApp(firebaseConfig);
            database = firebase.database(app);
            debugLog('‚úÖ Firebase Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
        } catch (error) {
            debugLog(`‚ùå Firebase Ï¥àÍ∏∞Ìôî Ïã§Ìå®: ${error.message}`);
        }

        let isRunning = false;

        // Î™ÖÎ†π Ï†ÑÏÜ° Ìï®Ïàò (ÎîîÎ≤ÑÍπÖ Í∞ïÌôî)
        function sendCommand(action) {
            const timestamp = Date.now();
            const commandData = {
                action: action,
                timestamp: timestamp
            };
            
            debugLog(`üì§ Î™ÖÎ†π Ï†ÑÏÜ° ÏãúÎèÑ: ${action}`);
            debugLog(`   ÌÉÄÏûÑÏä§ÌÉ¨ÌîÑ: ${timestamp}`);
            
            database.ref('commands').push(commandData)
                .then((ref) => {
                    debugLog(`‚úÖ Î™ÖÎ†π Ï†ÑÏÜ° ÏÑ±Í≥µ (ÌÇ§: ${ref.key})`);
                    debugLog(`   Îç∞Ïù¥ÌÑ∞: ${JSON.stringify(commandData)}`);
                })
                .catch((error) => {
                    debugLog(`‚ùå Î™ÖÎ†π Ï†ÑÏÜ° Ïã§Ìå®: ${error.message}`);
                });
        }

        // ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏ Ìï®Ïàò
        function updateStatus(status, indicatorClass) {
            document.getElementById('status').textContent = status;
            const indicator = document.getElementById('indicator');
            indicator.className = `status-indicator ${indicatorClass}`;
        }

        // ÌòÑÏû¨ ÌÉêÏßÄ Ï§ëÏù∏ Í∞ùÏ≤¥Î•º ÏÉÅÌÉú ÌëúÏãú ÏòÅÏó≠Ïóê ÏóÖÎç∞Ïù¥Ìä∏
        function updateCurrentObject(objectName) {
            document.getElementById('currentObject').textContent = objectName;
        }

        // Start Î≤ÑÌäº ÌÅ¥Î¶≠
        function startPickAndPlace() {
            debugLog('üöÄ START Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
            
            if (isRunning) {
                debugLog('‚ö†Ô∏è Ïù¥ÎØ∏ Ïã§Ìñâ Ï§ë');
                return;
            }

            isRunning = true;
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            document.getElementById('emergencyBtn').disabled = false;
            document.getElementById('spinner').classList.add('active');
            
            updateCurrentObject('ÌîÑÎ°úÏÑ∏Ïä§ ÏãúÏûë Ï§ë...');
            
            // FirebaseÏóê ÏãúÏûë Î™ÖÎ†π Ï†ÑÏÜ°
            sendCommand('start');
        }

        // Stop Î≤ÑÌäº ÌÅ¥Î¶≠
        function stopPickAndPlace() {
            debugLog('üõë STOP Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
            
            if (!isRunning) {
                debugLog('‚ö†Ô∏è Ïã§Ìñâ Ï§ëÏù¥ ÏïÑÎãò');
                return;
            }

            updateCurrentObject('ÌîÑÎ°úÏÑ∏Ïä§ Ï§ëÏßÄ Ï§ë...');

            // FirebaseÏóê Ï§ëÏßÄ Î™ÖÎ†π Ï†ÑÏÜ°
            sendCommand('stop');

            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('spinner').classList.remove('active');
        }

        // Emergency Stop Î≤ÑÌäº ÌÅ¥Î¶≠
        function emergencyStop() {
            debugLog('üö® EMERGENCY STOP Î≤ÑÌäº ÌÅ¥Î¶≠Îê®');
            
            updateCurrentObject('ÎπÑÏÉÅÏ†ïÏßÄ Ï§ë...');

            // FirebaseÏóê ÎπÑÏÉÅÏ†ïÏßÄ Î™ÖÎ†π Ï†ÑÏÜ°
            sendCommand('emergency_stop');

            isRunning = false;
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('emergencyBtn').disabled = true;
            document.getElementById('spinner').classList.remove('active');
        }

        // FirebaseÏóêÏÑú ÏÉÅÌÉú ÏùΩÍ∏∞ (Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏)
        database.ref('status').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                debugLog(`üìä ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏: ${data.currentStatus}`);
                updateStatus(data.currentStatus || 'ÎåÄÍ∏∞ Ï§ë', data.indicatorClass || '');
            }
        });

        // FirebaseÏóêÏÑú ÌÉêÏßÄ Ï§ëÏù∏ Í∞ùÏ≤¥ ÏÉÅÌÉú ÏùΩÍ∏∞ (Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏)
        database.ref('currentObject').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && data.name) {
                debugLog(`üéØ Í∞ùÏ≤¥ ÏóÖÎç∞Ïù¥Ìä∏: ${data.name}`);
                updateCurrentObject(data.name);
            }
        });

        // Firebase commands Î™®ÎãàÌÑ∞ÎßÅ (ÎîîÎ≤ÑÍπÖÏö©)
        database.ref('commands').on('child_added', (snapshot) => {
            const cmd = snapshot.val();
            debugLog(`üëÄ Î™ÖÎ†π Í∞êÏßÄÎê®: ${snapshot.key}`);
            debugLog(`   ÎÇ¥Ïö©: ${JSON.stringify(cmd)}`);
        });

        database.ref('commands').on('child_removed', (snapshot) => {
            debugLog(`üóëÔ∏è Î™ÖÎ†π ÏÇ≠Ï†úÎê®: ${snapshot.key}`);
        });

        // ÌéòÏù¥ÏßÄ Î°úÎìú Ïãú Ï¥àÍ∏∞ ÏÉÅÌÉú ÏÑ§Ï†ï
        window.onload = function() {
            debugLog('üåê ÌéòÏù¥ÏßÄ Î°úÎìú ÏôÑÎ£å');
            updateStatus('ÎåÄÍ∏∞ Ï§ë', '');
            updateCurrentObject('-');
            
            // ÌòÑÏû¨ commands Îç∞Ïù¥ÌÑ∞ ÌôïÏù∏
            database.ref('commands').once('value')
                .then((snapshot) => {
                    const data = snapshot.val();
                    debugLog(`üìã ÌòÑÏû¨ commands Îç∞Ïù¥ÌÑ∞: ${JSON.stringify(data)}`);
                })
                .catch((error) => {
                    debugLog(`‚ùå commands ÏùΩÍ∏∞ Ïã§Ìå®: ${error.message}`);
                });
        };
    </script>
</body>
</html>
